###############################################################################
# ğŸ¥ PRUEBAS E2E - CLÃNICA DENTAL (MÃšLTIPLES FLUJOS ALTERNATIVOS)
# SimulaciÃ³n Completa con TODOS los Escenarios Posibles
###############################################################################
#
# REQUISITOS PREVIOS:
# 1. Ejecutar: python seed_database.py --force
# 2. Iniciar servidor: python manage.py runserver 8001
#
# ï¿½ ESTRATEGIA DE PRUEBAS: MÃšLTIPLES FLUJOS REALISTAS
#
# El archivo estÃ¡ organizado en FLUJOS ALTERNATIVOS que prueban diferentes
# escenarios con intercambio constante de sesiones (login/logout) para
# simular el uso real del sistema.
#
# ğŸ“‹ FLUJOS IMPLEMENTADOS:
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸŸ¢ FLUJO 1: CASO FELIZ - Tratamiento Aprobado y Completado
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#   Paciente: Juan PÃ©rez (del seeder)
#   OdontÃ³logo: Dra. MarÃ­a LÃ³pez (del seeder)
#   Escenario: Todo sale bien, paciente aprueba y completa tratamiento
#   
#   1. ADMIN: Crear consulta programada
#   2. LOGOUT Admin â†’ LOGIN OdontÃ³logo
#   3. ODONTÃ“LOGO: Crear historial, odontograma, plan, presupuesto
#   4. LOGOUT OdontÃ³logo â†’ LOGIN Paciente
#   5. PACIENTE: Aprobar presupuesto, firmar consentimiento
#   6. LOGOUT Paciente â†’ LOGIN OdontÃ³logo
#   7. ODONTÃ“LOGO: Registrar sesiÃ³n, completar tratamiento
#   8. LOGOUT OdontÃ³logo â†’ LOGIN Admin
#   9. ADMIN: Generar factura, registrar pago
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ”´ FLUJO 2: RECHAZO - Paciente Rechaza el Presupuesto
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#   Paciente: Ana GarcÃ­a (nuevo)
#   OdontÃ³logo: Dr. Pedro RamÃ­rez (nuevo)
#   Escenario: Paciente rechaza presupuesto por precio alto
#   
#   1. ADMIN: Crear nuevo paciente y odontÃ³logo
#   2. ADMIN: Crear consulta
#   3. LOGOUT Admin â†’ LOGIN OdontÃ³logo Nuevo
#   4. ODONTÃ“LOGO: Crear plan de tratamiento costoso
#   5. LOGOUT OdontÃ³logo â†’ LOGIN Paciente Nuevo
#   6. PACIENTE: Ver presupuesto y RECHAZAR
#   7. LOGOUT Paciente â†’ LOGIN Admin
#   8. ADMIN: Marcar consulta como cancelada
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸŸ¡ FLUJO 3: MODIFICACIONES - Cambios en Plan de Tratamiento
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#   Paciente: Carlos Mendoza (nuevo)
#   OdontÃ³logo: Dra. MarÃ­a LÃ³pez (seeder)
#   Escenario: Plan inicial modificado, presupuesto actualizado
#   
#   1. ADMIN: Crear paciente, crear consulta
#   2. LOGOUT Admin â†’ LOGIN OdontÃ³logo
#   3. ODONTÃ“LOGO: Crear plan inicial
#   4. ODONTÃ“LOGO: MODIFICAR plan (agregar/quitar tratamientos)
#   5. ODONTÃ“LOGO: Actualizar presupuesto
#   6. LOGOUT OdontÃ³logo â†’ LOGIN Paciente
#   7. PACIENTE: Ver cambios y aprobar nuevo presupuesto
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸŸ£ FLUJO 4: ELIMINACIONES - Limpieza de Datos ErrÃ³neos
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#   Escenario: Datos creados por error que deben eliminarse
#   
#   1. ADMIN: Crear servicio errÃ³neo
#   2. ADMIN: Crear combo errÃ³neo
#   3. ADMIN: ELIMINAR servicio (soft delete)
#   4. ADMIN: ELIMINAR combo (soft delete)
#   5. ODONTÃ“LOGO: Crear plan de tratamiento duplicado
#   6. ODONTÃ“LOGO: ELIMINAR plan duplicado
#   7. Verificar que los elementos estÃ©n desactivados, no borrados
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ”µ FLUJO 5: MULTI-PACIENTE - OdontÃ³logo Atiende Varios Pacientes
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#   OdontÃ³logo: Dr. Pedro RamÃ­rez
#   Pacientes: 3 diferentes en el mismo dÃ­a
#   Escenario: Jornada laboral completa con mÃºltiples consultas
#   
#   1. ADMIN: Crear 3 consultas programadas para el mismo odontÃ³logo
#   2. LOGOUT Admin â†’ LOGIN OdontÃ³logo
#   3. ODONTÃ“LOGO: Atender paciente 1 (consulta simple)
#   4. ODONTÃ“LOGO: Cambiar a paciente 2 (tratamiento complejo)
#   5. ODONTÃ“LOGO: Cambiar a paciente 3 (urgencia)
#   6. ODONTÃ“LOGO: Completar las 3 consultas
#   7. LOGOUT OdontÃ³logo â†’ LOGIN Admin
#   8. ADMIN: Ver reportes del dÃ­a
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“Š COBERTURA DE PRUEBAS:
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# âœ… CRUD Completo de todas las entidades
# âœ… AprobaciÃ³n de presupuestos (FLUJO 1, 3)
# âœ… Rechazo de presupuestos (FLUJO 2)
# âœ… ModificaciÃ³n de planes (FLUJO 3)
# âœ… EliminaciÃ³n de datos (FLUJO 4)
# âœ… MÃºltiples sesiones concurrentes (FLUJO 5)
# âœ… Intercambio constante de roles (todos los flujos)
# âœ… AuditorÃ­a completa (verificar en cada cambio)
# âœ… Reportes y estadÃ­sticas (al final)
#
# ğŸ” FILOSOFÃA DE SESIONES:
#   - Cada acciÃ³n importante incluye LOGIN del rol apropiado
#   - LOGOUT explÃ­cito al cambiar de usuario
#   - Tokens especÃ­ficos para cada sesiÃ³n
#   - Simula uso real: mÃºltiples usuarios trabajando simultÃ¡neamente
#
###############################################################################

# Variables globales
@baseUrl = http://localhost:8001/api/v1


###############################################################################
# 1ï¸âƒ£ ROL: ADMINISTRADOR (ConfiguraciÃ³n Inicial del Sistema)
###############################################################################

### 1.1. Admin: Login
# @name adminLogin
POST {{baseUrl}}/auth/login/
Content-Type: application/json

{
  "correo": "admin@clinica.com",
  "password": "admin123"
}

###
@adminToken = {{adminLogin.response.body.token}}
@adminCodigo = {{adminLogin.response.body.usuario.codigo}}

### 1.2. Admin: Verificar Token
GET {{baseUrl}}/auth/verificar-token/
Authorization: Token {{adminToken}}

### 1.3. Admin: Ver Todos los Usuarios
GET {{baseUrl}}/usuarios/usuarios/
Authorization: Token {{adminToken}}

### 1.4. Admin: Ver Tipos de Usuario
# @name tiposUsuario
GET {{baseUrl}}/usuarios/tipos-usuario/
Authorization: Token {{adminToken}}

### 1.5. Admin: Crear Nuevo Usuario (OdontÃ³logo)
# @name crearUsuario
POST {{baseUrl}}/usuarios/usuarios/
Authorization: Token {{adminToken}}
Content-Type: application/json

{
  "nombre": "Pedro",
  "apellido": "RamÃ­rez Torres",
  "correoelectronico": "dr.ramirez@clinica.com",
  "sexo": "M",
  "telefono": "70000020",
  "idtipousuario": {{tiposUsuario.response.body.results.[1].id}}
}

###
@nuevoUsuarioCodigo = {{crearUsuario.response.body.codigo}}

### 1.5b. Admin: Ver Detalle de Usuario EspecÃ­fico
GET {{baseUrl}}/usuarios/usuarios/{{nuevoUsuarioCodigo}}/
Authorization: Token {{adminToken}}

### 1.6. Admin: Crear Perfil de OdontÃ³logo (Extender usuario)
# @name crearOdontologo
POST {{baseUrl}}/profesionales/odontologos/
Authorization: Token {{adminToken}}
Content-Type: application/json

{
  "codusuario": {{nuevoUsuarioCodigo}},
  "especialidad": "Periodoncia",
  "nromatricula": "ODO-004",
  "experienciaprofesional": "5 aÃ±os de experiencia en periodoncia"
}

### 1.7. Admin: Ver OdontÃ³logos Registrados
GET {{baseUrl}}/profesionales/odontologos/
Authorization: Token {{adminToken}}

### 1.7b. Admin: Ver Detalle de OdontÃ³logo EspecÃ­fico
GET {{baseUrl}}/profesionales/odontologos/{{nuevoUsuarioCodigo}}/
Authorization: Token {{adminToken}}

### 1.8. Admin: Ver Todos los Servicios
GET {{baseUrl}}/administracion/servicios/
Authorization: Token {{adminToken}}

### 1.9. Admin: Crear Nuevo Servicio
# @name crearServicio
POST {{baseUrl}}/administracion/servicios/
Authorization: Token {{adminToken}}
Content-Type: application/json

{
  "nombre": "RadiografÃ­a PanorÃ¡mica",
  "descripcion": "RadiografÃ­a completa de la boca",
  "costobase": 180.00,
  "duracion": 20,
  "activo": true
}

###
@servicioId = {{crearServicio.response.body.id}}

### 1.10. Admin: Ver Inventario
# @name listarInsumosExistentes
GET {{baseUrl}}/inventario/insumos/
Authorization: Token {{adminToken}}

###
# Capturar primer insumo existente como fallback
@insumoExistenteId = {{listarInsumosExistentes.response.body.results.[0].id}}

### 1.10b. Admin: Ver ConfiguraciÃ³n del Sistema
GET {{baseUrl}}/administracion/configuracion/
Authorization: Token {{adminToken}}

### 1.11. Admin: Ver Alertas de Inventario
GET {{baseUrl}}/inventario/alertas/?resuelta=false
Authorization: Token {{adminToken}}

### 1.12. Admin: Ver Lista de Pacientes Existentes
# @name listarPacientesAdmin
GET {{baseUrl}}/usuarios/pacientes/
Authorization: Token {{adminToken}}

###
@paciente1Codigo = {{listarPacientesAdmin.response.body.results.[0].codusuario}}
@paciente2Codigo = {{listarPacientesAdmin.response.body.results.[1].codusuario}}

### 1.13. Admin: Ver Horarios Disponibles
# @name listarHorarios
GET {{baseUrl}}/citas/horarios/
Authorization: Token {{adminToken}}

###
@horario10am = {{listarHorarios.response.body.results.[4].id}}
@horario3pm = {{listarHorarios.response.body.results.[14].id}}

### 1.13b. Admin: Ver todos los horarios (el endpoint no permite crear)
# Los horarios son creados por el seeder
GET {{baseUrl}}/citas/horarios/
Authorization: Token {{adminToken}}

### 1.14. Admin: Ver Tipos de Consulta
# @name listarTiposConsulta
GET {{baseUrl}}/citas/tipos-consulta/
Authorization: Token {{adminToken}}

###
@tipoConsultaPrimeraVez = {{listarTiposConsulta.response.body.results.[0].id}}
@tipoConsultaControl = {{listarTiposConsulta.response.body.results.[1].id}}

### 1.15. Admin: Ver Estados de Consulta
# @name listarEstadosConsulta
GET {{baseUrl}}/citas/estados-consulta/
Authorization: Token {{adminToken}}

###
@estadoConfirmada = {{listarEstadosConsulta.response.body.results.[1].id}}

### 1.16. Admin: Ver OdontÃ³logos para Asignar
# @name listarOdontologos
GET {{baseUrl}}/profesionales/odontologos/
Authorization: Token {{adminToken}}

###
@odontologoPrincipalCodigo = {{listarOdontologos.response.body.results.[0].codusuario}}

### 1.17. Admin: Crear Consulta para Paciente 1 (Hoy)
# @name crearConsulta1
POST {{baseUrl}}/citas/consultas/
Authorization: Token {{adminToken}}
Content-Type: application/json

{
  "codpaciente": {{paciente1Codigo}},
  "cododontologo": {{odontologoPrincipalCodigo}},
  "fecha": "2025-11-03",
  "idhorario": {{horario10am}},
  "idtipoconsulta": {{tipoConsultaPrimeraVez}},
  "idestadoconsulta": {{estadoConfirmada}},
  "motivo_consulta": "Dolor en muela y revisiÃ³n general"
}

###
@consulta1Id = {{crearConsulta1.response.body.id}}

### 1.18. Admin: Crear Consulta para Paciente 2 (Programada)
# @name crearConsulta2
POST {{baseUrl}}/citas/consultas/
Authorization: Token {{adminToken}}
Content-Type: application/json

{
  "codpaciente": {{paciente2Codigo}},
  "cododontologo": {{odontologoPrincipalCodigo}},
  "fecha": "2025-11-05",
  "idhorario": {{horario3pm}},
  "idtipoconsulta": {{tipoConsultaControl}},
  "idestadoconsulta": {{estadoConfirmada}},
  "motivo_consulta": "Control de tratamiento de ortodoncia"
}

###
@consulta2Id = {{crearConsulta2.response.body.id}}

### 1.18b. Admin: Actualizar Consulta (Cambiar horario)
PUT {{baseUrl}}/citas/consultas/{{consulta2Id}}/
Authorization: Token {{adminToken}}
Content-Type: application/json

{
  "codpaciente": {{paciente2Codigo}},
  "cododontologo": {{odontologoPrincipalCodigo}},
  "fecha": "2025-11-05",
  "idhorario": {{horario10am}},
  "idtipoconsulta": {{tipoConsultaControl}},
  "idestadoconsulta": {{estadoConfirmada}},
  "motivo_consulta": "Control de tratamiento de ortodoncia - HORARIO MODIFICADO"
}

### 1.18c. Admin: Ver Disponibilidad de Horarios para una Fecha
GET {{baseUrl}}/citas/consultas/disponibilidad/?fecha=2025-11-05&odontologo={{odontologoPrincipalCodigo}}
Authorization: Token {{adminToken}}

### 1.18d. Admin: Crear Nuevo Paciente (Registro directo)
# @name crearPacienteDirecto
POST {{baseUrl}}/usuarios/pacientes/
Authorization: Token {{adminToken}}
Content-Type: application/json

{
  "nombre": "MarÃ­a",
  "apellido": "Gutierrez Morales",
  "correoelectronico": "maria.gutierrez@email.com",
  "sexo": "F",
  "telefono": "70000030",
  "carnetidentidad": "9876543",
  "fechanacimiento": "1998-06-15",
  "direccion": "Calle Murillo #567"
}

###
@paciente3Codigo = {{crearPacienteDirecto.response.body.codusuario}}

### 1.18e-pre. Admin: Obtener datos actuales del paciente (para capturar idtipousuario)
# @name obtenerPaciente3
GET {{baseUrl}}/usuarios/usuarios/{{paciente3Codigo}}/
Authorization: Token {{adminToken}}

###
@paciente3TipoUsuario = {{obtenerPaciente3.response.body.idtipousuario}}

### 1.18e. Admin: Actualizar Datos de Paciente
PUT {{baseUrl}}/usuarios/usuarios/{{paciente3Codigo}}/
Authorization: Token {{adminToken}}
Content-Type: application/json

{
  "nombre": "MarÃ­a JosÃ©",
  "apellido": "Gutierrez Morales",
  "correoelectronico": "maria.gutierrez@email.com",
  "sexo": "F",
  "telefono": "70000031",
  "idtipousuario": {{paciente3TipoUsuario}}
}

### 1.18f. Admin: Actualizar Servicio Existente
PUT {{baseUrl}}/administracion/servicios/{{servicioId}}/
Authorization: Token {{adminToken}}
Content-Type: application/json

{
  "nombre": "RadiografÃ­a PanorÃ¡mica Digital",
  "descripcion": "RadiografÃ­a completa de la boca con tecnologÃ­a digital",
  "costobase": 200.00,
  "duracion": 20,
  "activo": true
}

### 1.18g. Admin: Ver Combos de Servicios
# @name listarCombosExistentes
GET {{baseUrl}}/administracion/combos/
Authorization: Token {{adminToken}}

###
# Capturar primer combo existente como fallback
@comboExistenteId = {{listarCombosExistentes.response.body.results.[0].id}}

### 1.18g2. Admin: Listar Servicios (para obtener IDs)
# @name listarServiciosCombo
GET {{baseUrl}}/administracion/servicios/
Authorization: Token {{adminToken}}

###
@servicio1Id = {{listarServiciosCombo.response.body.results.[0].id}}
@servicio2Id = {{listarServiciosCombo.response.body.results.[1].id}}

### 1.18h. Admin: Crear Combo de Servicios NUEVO
# @name crearCombo
# NOTA: Si falla por nombre duplicado, usa @comboExistenteId en 1.18h2
POST {{baseUrl}}/administracion/combos/
Authorization: Token {{adminToken}}
Content-Type: application/json

{
  "nombre": "Paquete Limpieza + Blanqueamiento",
  "descripcion": "Combo especial de limpieza y blanqueamiento dental",
  "tipo_precio": "PORCENTAJE",
  "valor_precio": 15.00,
  "detalles": [
    {
      "servicio_id": {{servicio1Id}},
      "cantidad": 1
    },
    {
      "servicio_id": {{servicio2Id}},
      "cantidad": 1
    }
  ],
  "activo": true
}

###
@comboId = {{crearCombo.response.body.id}}

### 1.18h2. Admin: Actualizar Combo de Servicios
# IMPORTANTE: Si 1.18h fallÃ³, cambia {{comboId}} por {{comboExistenteId}}
PUT {{baseUrl}}/administracion/combos/{{comboExistenteId}}/
Authorization: Token {{adminToken}}
Content-Type: application/json

{
  "nombre": "Paquete Premium Limpieza + Blanqueamiento - ACTUALIZADO",
  "descripcion": "Combo especial de limpieza y blanqueamiento dental - ACTUALIZADO",
  "tipo_precio": "PORCENTAJE",
  "valor_precio": 20.00,
  "detalles": [
    {
      "servicio_id": {{servicio1Id}},
      "cantidad": 1
    },
    {
      "servicio_id": {{servicio2Id}},
      "cantidad": 1
    }
  ],
  "activo": true
}

### 1.18h3. Admin: Eliminar Combo de Servicios
# Nota: Comentado por seguridad - descomentar solo si es necesario
# DELETE {{baseUrl}}/administracion/combos/1/
# Authorization: Token {{adminToken}}

### 1.18i. Admin: Ver CategorÃ­as de Inventario
# @name listarCategoriasInventario
GET {{baseUrl}}/inventario/categorias/
Authorization: Token {{adminToken}}

###
@categoria1Id = {{listarCategoriasInventario.response.body.results.[0].id}}

### 1.18j. Admin: Crear CategorÃ­a de Inventario
# @name crearCategoria
POST {{baseUrl}}/inventario/categorias/
Authorization: Token {{adminToken}}
Content-Type: application/json

{
  "nombre": "Equipamiento",
  "descripcion": "Equipos y herramientas dentales",
  "activo": true
}

###
@categoriaNuevaId = {{crearCategoria.response.body.id}}

### 1.18j2. Admin: Actualizar CategorÃ­a de Inventario
PUT {{baseUrl}}/inventario/categorias/{{categoriaNuevaId}}/
Authorization: Token {{adminToken}}
Content-Type: application/json

{
  "nombre": "Equipamiento Dental",
  "descripcion": "Equipos y herramientas dentales - ACTUALIZADO",
  "activo": true
}

### 1.18k. Admin: Ver Proveedores
# @name listarProveedores
GET {{baseUrl}}/inventario/proveedores/
Authorization: Token {{adminToken}}

###
@proveedor1Id = {{listarProveedores.response.body.results.[0].id}}

### 1.18l. Admin: Crear Proveedor
# @name crearProveedor
POST {{baseUrl}}/inventario/proveedores/
Authorization: Token {{adminToken}}
Content-Type: application/json

{
  "nombre": "MediDental Imports",
  "ruc": "9876543210",
  "direccion": "Av. Arce #890",
  "telefono": "2-3456789",
  "email": "ventas@medidental.com",
  "contacto_nombre": "Roberto Silva",
  "contacto_telefono": "70999888",
  "activo": true
}

###
@proveedorNuevoId = {{crearProveedor.response.body.id}}

### 1.18l2. Admin: Actualizar Proveedor
PUT {{baseUrl}}/inventario/proveedores/{{proveedorNuevoId}}/
Authorization: Token {{adminToken}}
Content-Type: application/json

{
  "nombre": "MediDental Imports S.A.",
  "ruc": "9876543210",
  "direccion": "Av. Arce #890, Zona Central",
  "telefono": "2-3456789",
  "email": "ventas@medidental.com",
  "contacto_nombre": "Roberto Silva",
  "contacto_telefono": "70999888",
  "activo": true,
  "notas": "Proveedor principal - ACTUALIZADO"
}

### 1.18m. Admin: Crear Insumo en Inventario
# @name crearInsumo
POST {{baseUrl}}/inventario/insumos/
Authorization: Token {{adminToken}}
Content-Type: application/json

{
  "codigo": "INS-TEST-001",
  "nombre": "Guantes de LÃ¡tex",
  "descripcion": "Guantes de lÃ¡tex talla M",
  "categoria": {{categoria1Id}},
  "proveedor_principal": {{proveedor1Id}},
  "stock_actual": 100,
  "stock_minimo": 50,
  "stock_maximo": 200,
  "unidad_medida": "caja",
  "precio_compra": 35.00,
  "precio_venta": 0,
  "requiere_vencimiento": true,
  "fecha_vencimiento": "2026-12-31",
  "activo": true
}

###
@insumoId = {{crearInsumo.response.body.id}}

### 1.18m2. Admin: Ver Detalle de Insumo EspecÃ­fico
# IMPORTANTE: Si 1.18m fallÃ³ por duplicado, este usa el insumo existente capturado en 1.10
GET {{baseUrl}}/inventario/insumos/{{insumoExistenteId}}/
Authorization: Token {{adminToken}}

### 1.18n. Admin: Actualizar Insumo
# USA DATOS DEL SEEDER - No intenta cambiar cÃ³digo, solo actualiza otros campos
# IMPORTANTE: NO cambies el cÃ³digo para evitar duplicados
PATCH {{baseUrl}}/inventario/insumos/{{insumoExistenteId}}/
Authorization: Token {{adminToken}}
Content-Type: application/json

{
  "nombre": "Guantes de LÃ¡tex Premium - ACTUALIZADO",
  "descripcion": "Guantes de lÃ¡tex premium talla M - ACTUALIZADO",
  "stock_actual": 150,
  "precio_compra": 40.00,
  "observaciones": "Stock actualizado despuÃ©s de inventario"
}

### 1.18o. Admin: Ver Movimientos de Inventario
GET {{baseUrl}}/inventario/movimientos/
Authorization: Token {{adminToken}}

### 1.18p. Admin: Registrar Movimiento de Inventario (Entrada)
# @name crearMovimiento
# IMPORTANTE: Si 1.18m fallÃ³, cambia {{insumoId}} por {{insumoExistenteId}}
POST {{baseUrl}}/inventario/movimientos/
Authorization: Token {{adminToken}}
Content-Type: application/json

{
  "insumo": {{insumoExistenteId}},
  "tipo_movimiento": "entrada",
  "cantidad": 50,
  "motivo": "Compra a proveedor",
  "realizado_por": {{adminCodigo}},
  "notas": "Pedido #12345"
}

### 1.18q. Admin: Actualizar OdontÃ³logo Existente
PUT {{baseUrl}}/profesionales/odontologos/{{odontologoPrincipalCodigo}}/
Authorization: Token {{adminToken}}
Content-Type: application/json

{
  "codusuario": {{odontologoPrincipalCodigo}},
  "especialidad": "Ortodoncia y Ortopedia",
  "nromatricula": "ODO-001",
  "experienciaprofesional": "12 aÃ±os de experiencia en ortodoncia y ortopedia maxilar"
}

### 1.18r. Admin: Ver Disponibilidad de OdontÃ³logo
GET {{baseUrl}}/profesionales/odontologos/{{odontologoPrincipalCodigo}}/disponibilidad/?fecha=2025-11-05
Authorization: Token {{adminToken}}

### 1.18s. Admin: Ver Especialidades Disponibles
GET {{baseUrl}}/profesionales/especialidades/
Authorization: Token {{adminToken}}

### 1.19. Admin: LOGOUT
POST {{baseUrl}}/auth/logout/
Authorization: Token {{adminToken}}


###############################################################################
# 2ï¸âƒ£ SESIÃ“N 2: ODONTÃ“LOGO (AtenciÃ³n ClÃ­nica Completa)
###############################################################################

### 2.1. OdontÃ³logo: Login (Dr. PÃ©rez - Creado por seeder)
# @name odontologoLogin
POST {{baseUrl}}/auth/login/
Content-Type: application/json

{
  "correo": "dr.perez@clinica.com",
  "password": "odontologo123"
}

###
@odontologoToken = {{odontologoLogin.response.body.token}}
@odontologoCodigo = {{odontologoLogin.response.body.usuario.codigo}}

### 2.2. OdontÃ³logo: Ver Mi Perfil
GET {{baseUrl}}/usuarios/usuarios/yo/
Authorization: Token {{odontologoToken}}

### 2.3. OdontÃ³logo: Ver Mis Consultas Programadas (filtradas por odontÃ³logo)
GET {{baseUrl}}/citas/consultas/?cododontologo={{odontologoCodigo}}
Authorization: Token {{odontologoToken}}

### 2.4. OdontÃ³logo: Ver Consultas Programadas (todas)
GET {{baseUrl}}/citas/consultas/
Authorization: Token {{odontologoToken}}

### 2.5. OdontÃ³logo: Ver Lista de Pacientes
GET {{baseUrl}}/usuarios/pacientes/
Authorization: Token {{odontologoToken}}

### 2.6. OdontÃ³logo: Crear Historia ClÃ­nica para Paciente 1 (Ana LÃ³pez)
# @name crearHistorial
POST {{baseUrl}}/historial-clinico/
Authorization: Token {{odontologoToken}}
Content-Type: application/json

{
  "pacientecodigo": {{paciente1Codigo}},
  "motivoconsulta": "Dolor en muela inferior derecha",
  "diagnostico": "Caries profunda en pieza 30",
  "tratamiento": "Endodoncia programada",
  "alergias": "Ninguna",
  "enfermedades": "Diabetes tipo 2 controlada",
  "examenbucal": "Caries profunda con exposiciÃ³n pulpar",
  "receta": "Ibuprofeno 400mg cada 8 horas por 3 dÃ­as"
}

###
@historialId = {{crearHistorial.response.body.id}}

### 2.7. OdontÃ³logo: Crear Odontograma para Paciente
# @name crearOdontograma
POST {{baseUrl}}/historial-clinico/odontogramas/
Authorization: Token {{odontologoToken}}
Content-Type: application/json

{
  "paciente": {{paciente1Codigo}},
  "odontologo": {{odontologoCodigo}},
  "observaciones_generales": "Primera evaluaciÃ³n completa"
}

###
@odontogramaId = {{crearOdontograma.response.body.id}}

### 2.7b. OdontÃ³logo: Listar Odontogramas del Paciente (para obtener ID)
# @name listarOdontogramas
GET {{baseUrl}}/historial-clinico/odontogramas/?paciente={{paciente1Codigo}}
Authorization: Token {{odontologoToken}}

###
# Capturar ID del odontograma como backup
@odontogramaIdBackup = {{listarOdontogramas.response.body.results.[0].id}}

### 2.8. OdontÃ³logo: Actualizar Diente en Odontograma
# Nota: Si @odontogramaId falla, usar @odontogramaIdBackup manualmente
POST {{baseUrl}}/historial-clinico/odontogramas/{{odontogramaId}}/actualizar_diente/
Authorization: Token {{odontologoToken}}
Content-Type: application/json

{
  "numero_diente": 30,
  "estado": "caries",
  "caras_afectadas": ["oclusal", "distal"],
  "observaciones": "Caries profunda con exposiciÃ³n pulpar"
}

### 2.8b. OdontÃ³logo: Listar Planes de Tratamiento Existentes (FALLBACK)
# @name listarPlanesExistentes
GET {{baseUrl}}/tratamientos/planes-tratamiento/
Authorization: Token {{odontologoToken}}

###
# Capturar primer plan existente como fallback
@planExistenteId = {{listarPlanesExistentes.response.body.results.[0].id}}

### 2.9. OdontÃ³logo: Crear Plan de Tratamiento
# @name crearPlan
# NOTA: Si falla por duplicado, usa @planExistenteId en las siguientes peticiones
POST {{baseUrl}}/tratamientos/planes-tratamiento/
Authorization: Token {{odontologoToken}}
Content-Type: application/json

{
  "paciente": {{paciente1Codigo}},
  "odontologo": {{odontologoCodigo}},
  "descripcion": "Plan de endodoncia y restauraciÃ³n",
  "diagnostico": "Caries profunda con compromiso pulpar en pieza 30",
  "estado": "borrador",
  "duracion_estimada_dias": 21
}

###
@planId = {{crearPlan.response.body.id}}

### 2.9b. OdontÃ³logo: Listar Servicios para Presupuesto
# @name listarServicios
GET {{baseUrl}}/administracion/servicios/
Authorization: Token {{odontologoToken}}

###
@servicioEndodoncia = {{listarServicios.response.body.results.[4].id}}
@servicioCorona = {{listarServicios.response.body.results.[5].id}}

### 2.10. OdontÃ³logo: Crear Presupuesto para el Plan
# @name crearPresupuesto
POST {{baseUrl}}/tratamientos/presupuestos/
Authorization: Token {{odontologoToken}}
Content-Type: application/json

{
  "plan_tratamiento": {{planId}},
  "items": [
    {
      "servicio": {{servicioEndodoncia}},
      "cantidad": 1,
      "precio_unitario": 800.00,
      "numero_diente": 30
    },
    {
      "servicio": {{servicioCorona}},
      "cantidad": 1,
      "precio_unitario": 1500.00,
      "numero_diente": 30
    }
  ],
  "descuento": 200.00,
  "notas": "Descuento por pago al contado"
}

###
@presupuestoId = {{crearPresupuesto.response.body.id}}

### 2.11. OdontÃ³logo: Listar Presupuestos Creados
GET {{baseUrl}}/tratamientos/presupuestos/
Authorization: Token {{odontologoToken}}

### 2.12. OdontÃ³logo: Crear Consentimiento Informado
# @name crearConsentimiento
POST {{baseUrl}}/historial-clinico/consentimientos/
Authorization: Token {{odontologoToken}}
Content-Type: application/json

{
  "paciente": {{paciente1Codigo}},
  "odontologo": {{odontologoCodigo}},
  "tipo_tratamiento": "Endodoncia",
  "contenido_documento": "El paciente autoriza la realizaciÃ³n de tratamiento de conducto (endodoncia) en la pieza dental #30...",
  "riesgos": "Posible fractura del instrumento, dolor post-operatorio, necesidad de retratamiento",
  "beneficios": "PreservaciÃ³n de la pieza dental, eliminaciÃ³n del dolor",
  "alternativas": "ExtracciÃ³n dental e implante",
  "estado": "pendiente"
}

###
@consentimientoId = {{crearConsentimiento.response.body.id}}

### 2.12b. OdontÃ³logo: Ver Detalle de Historial ClÃ­nico Creado
GET {{baseUrl}}/historial-clinico/{{historialId}}/
Authorization: Token {{odontologoToken}}

### 2.12c. OdontÃ³logo: Actualizar Historial ClÃ­nico
PUT {{baseUrl}}/historial-clinico/{{historialId}}/
Authorization: Token {{odontologoToken}}
Content-Type: application/json

{
  "pacientecodigo": {{paciente1Codigo}},
  "motivoconsulta": "Dolor en muela inferior derecha",
  "diagnostico": "Caries profunda en pieza 30 con pulpitis irreversible",
  "tratamiento": "Endodoncia programada - ACTUALIZADO",
  "alergias": "Ninguna conocida",
  "enfermedades": "Diabetes tipo 2 controlada con metformina",
  "examenbucal": "Caries profunda con exposiciÃ³n pulpar, dolor a la percusiÃ³n",
  "receta": "Ibuprofeno 400mg cada 8 horas por 3 dÃ­as + Amoxicilina 500mg cada 8 horas por 7 dÃ­as"
}

### 2.12d. OdontÃ³logo: Actualizar Odontograma Completo
PUT {{baseUrl}}/historial-clinico/odontogramas/{{odontogramaId}}/
Authorization: Token {{odontologoToken}}
Content-Type: application/json

{
  "paciente": {{paciente1Codigo}},
  "odontologo": {{odontologoCodigo}},
  "observaciones_generales": "EvaluaciÃ³n completa - Actualizado con nuevos hallazgos",
  "dientes": {
    "30": {
      "numero": 30,
      "estado": "caries",
      "caras_afectadas": ["oclusal", "distal"],
      "observaciones": "Caries profunda con exposiciÃ³n pulpar - requiere endodoncia",
      "tratamientos": []
    },
    "31": {
      "numero": 31,
      "estado": "sano",
      "caras_afectadas": [],
      "observaciones": "",
      "tratamientos": []
    }
  }
}

### 2.12e. OdontÃ³logo: Actualizar Plan de Tratamiento
# USA PLAN EXISTENTE - Si crear fallÃ³, usa @planExistenteId
PUT {{baseUrl}}/tratamientos/planes-tratamiento/{{planExistenteId}}/
Authorization: Token {{odontologoToken}}
Content-Type: application/json

{
  "paciente": {{paciente1Codigo}},
  "odontologo": {{odontologoCodigo}},
  "descripcion": "Plan de endodoncia y restauraciÃ³n - ACTUALIZADO",
  "diagnostico": "Caries profunda con compromiso pulpar en pieza 30 - Pulpitis irreversible",
  "estado": "borrador",
  "duracion_estimada_dias": 28,
  "observaciones": "Paciente diabÃ©tico - considerar antibiÃ³tico profilÃ¡ctico"
}

### 2.12g. OdontÃ³logo: Actualizar Presupuesto
# COMENTADO - Actualizar presupuesto requiere campos complejos, mejor usar GET
# Si quieres actualizar, primero haz GET para obtener todos los campos requeridos
# PUT {{baseUrl}}/tratamientos/presupuestos/{{presupuestoId}}/
# Authorization: Token {{odontologoToken}}
# Content-Type: application/json
#
# {
#   "plan_tratamiento": {{planExistenteId}},
#   "subtotal": 2300.00,
#   "descuento": 250.00,
#   "total": 2050.00,
#   "notas": "Descuento especial por pago anticipado - ACTUALIZADO"
# }

### 2.12g-alt. OdontÃ³logo: Ver Presupuesto en su lugar
GET {{baseUrl}}/tratamientos/presupuestos/{{presupuestoId}}/
Authorization: Token {{odontologoToken}}

### 2.12g2. OdontÃ³logo: Eliminar Plan de Tratamiento
# Nota: Comentado por seguridad - descomentar solo si es necesario
# DELETE {{baseUrl}}/tratamientos/planes-tratamiento/{{planId}}/
# Authorization: Token {{odontologoToken}}

### 2.12h. OdontÃ³logo: Listar Procedimientos del Plan
# USA PLAN EXISTENTE
GET {{baseUrl}}/tratamientos/procedimientos/?plan_tratamiento={{planExistenteId}}
Authorization: Token {{odontologoToken}}

### 2.12i. OdontÃ³logo: Crear Procedimiento Manual
# @name crearProcedimiento
POST {{baseUrl}}/tratamientos/procedimientos/
Authorization: Token {{odontologoToken}}
Content-Type: application/json

{
  "plan_tratamiento": {{planExistenteId}},
  "servicio": {{servicioEndodoncia}},
  "odontologo": {{odontologoCodigo}},
  "numero_diente": 30,
  "descripcion": "Primera sesiÃ³n de endodoncia - apertura cameral",
  "estado": "completado",
  "fecha_planificada": "2025-11-03",
  "fecha_realizado": "2025-11-03",
  "duracion_minutos": 90,
  "costo_estimado": 400.00,
  "costo_real": 400.00,
  "notas": "Procedimiento completado sin complicaciones"
}

###
@procedimientoId = {{crearProcedimiento.response.body.id}}

### 2.12j. OdontÃ³logo: Listar Sesiones de Tratamiento
# USA PLAN EXISTENTE
GET {{baseUrl}}/tratamientos/sesiones-tratamiento/?plan_tratamiento={{planExistenteId}}
Authorization: Token {{odontologoToken}}

### 2.12k. OdontÃ³logo: Crear SesiÃ³n de Tratamiento
# @name crearSesion
POST {{baseUrl}}/tratamientos/sesiones-tratamiento/
Authorization: Token {{odontologoToken}}
Content-Type: application/json

{
  "plan_tratamiento": {{planExistenteId}},
  "odontologo": {{odontologoCodigo}},
  "titulo": "Primera SesiÃ³n - Endodoncia",
  "fecha_programada": "2025-11-04",
  "fecha_sesion": "2025-11-03",
  "numero_sesion": 1,
  "duracion_minutos": 90,
  "procedimientos_realizados": "Apertura cameral, limpieza de conductos",
  "observaciones": "Paciente tolerÃ³ bien el procedimiento",
  "proxima_cita": "2025-11-10",
  "estado": "completada"
}

###
@sesionId = {{crearSesion.response.body.id}}

### 2.12l. OdontÃ³logo: Ver Documentos del Historial ClÃ­nico
GET {{baseUrl}}/historial-clinico/documentos/?paciente={{paciente1Codigo}}
Authorization: Token {{odontologoToken}}

### 2.12m. OdontÃ³logo: Cambiar Estado de Consulta a "En Consulta"
PATCH {{baseUrl}}/citas/consultas/{{consulta1Id}}/actualizar_estado/
Authorization: Token {{odontologoToken}}
Content-Type: application/json

{
  "estado": "en_consulta",
  "observaciones": "Paciente en atenciÃ³n"
}

### 2.12n. OdontÃ³logo: Cambiar Estado de Consulta a "Completada"
PATCH {{baseUrl}}/citas/consultas/{{consulta1Id}}/actualizar_estado/
Authorization: Token {{odontologoToken}}
Content-Type: application/json

{
  "estado": "completada",
  "observaciones": "Consulta finalizada exitosamente",
  "diagnostico": "Caries profunda en pieza 30",
  "tratamiento": "Endodoncia programada",
  "costo_consulta": 150.00
}

### 2.13. OdontÃ³logo: LOGOUT
POST {{baseUrl}}/auth/logout/
Authorization: Token {{odontologoToken}}


###############################################################################
# 3ï¸âƒ£ SESIÃ“N 3: PACIENTE (Consulta de InformaciÃ³n y Aprobaciones)
###############################################################################

### 3.1. Paciente: Login (Ana LÃ³pez - Paciente 1 del seeder)
# @name pacienteLogin
POST {{baseUrl}}/auth/login/
Content-Type: application/json

{
  "correo": "ana.lopez@email.com",
  "password": "paciente123"
}

###
@pacienteToken = {{pacienteLogin.response.body.token}}
@pacienteCodigo = {{pacienteLogin.response.body.usuario.codigo}}

### 3.2. Paciente: Ver Mi Perfil
GET {{baseUrl}}/usuarios/usuarios/yo/
Authorization: Token {{pacienteToken}}

### 3.3. Paciente: Ver Mi Perfil de Paciente (Detalle Completo)
GET {{baseUrl}}/usuarios/pacientes/mi_perfil/
Authorization: Token {{pacienteToken}}

### 3.4. Paciente: Ver Mis Consultas
GET {{baseUrl}}/citas/consultas/mis_consultas/
Authorization: Token {{pacienteToken}}

### 3.5. Paciente: Ver Mis Historiales ClÃ­nicos
GET {{baseUrl}}/historial-clinico/por_paciente/?paciente_id={{pacienteCodigo}}
Authorization: Token {{pacienteToken}}

### 3.6. Paciente: Ver Mis Odontogramas
GET {{baseUrl}}/historial-clinico/odontogramas/?paciente={{pacienteCodigo}}
Authorization: Token {{pacienteToken}}

### 3.7. Paciente: Ver Mis Planes de Tratamiento
GET {{baseUrl}}/tratamientos/planes-tratamiento/por-paciente/?paciente_id={{pacienteCodigo}}
Authorization: Token {{pacienteToken}}

### 3.8. Paciente: Ver Mis Presupuestos
GET {{baseUrl}}/tratamientos/presupuestos/mis-presupuestos/
Authorization: Token {{pacienteToken}}

### 3.9. Paciente: Ver Detalle del Presupuesto Creado
GET {{baseUrl}}/tratamientos/presupuestos/{{presupuestoId}}/
Authorization: Token {{pacienteToken}}

### 3.10. Paciente: Aprobar Presupuesto
POST {{baseUrl}}/tratamientos/presupuestos/{{presupuestoId}}/aprobar/
Authorization: Token {{pacienteToken}}
Content-Type: application/json

{
  "aprobado_por": "Ana LÃ³pez (Paciente)"
}

### 3.11. Paciente: Ver Mis Consentimientos Informados
GET {{baseUrl}}/historial-clinico/consentimientos/por_paciente/?paciente_id={{pacienteCodigo}}
Authorization: Token {{pacienteToken}}

### 3.12. Paciente: Firmar Consentimiento Informado
POST {{baseUrl}}/historial-clinico/consentimientos/{{consentimientoId}}/firmar/
Authorization: Token {{pacienteToken}}
Content-Type: application/json

{
  "firma_paciente_url": "https://s3.amazonaws.com/firma-ana-lopez.png",
  "ip_firma": "192.168.1.100"
}

### 3.13. Paciente: Ver Mi Historial de Pagos
GET {{baseUrl}}/tratamientos/pagos/mis-pagos/
Authorization: Token {{pacienteToken}}

### 3.13b. Paciente: Rechazar Presupuesto (Ejemplo de flujo alternativo)
# Nota: Solo usar si quieres probar el rechazo
# POST {{baseUrl}}/tratamientos/presupuestos/{{presupuestoId}}/rechazar/
# Authorization: Token {{pacienteToken}}
# Content-Type: application/json
# 
# {
#   "motivo_rechazo": "Costo muy elevado, buscarÃ© segunda opiniÃ³n"
# }

### 3.14. Paciente: LOGOUT
POST {{baseUrl}}/auth/logout/
Authorization: Token {{pacienteToken}}


###############################################################################
# 4ï¸âƒ£ SESIÃ“N 4: ADMIN (Reportes y AuditorÃ­a)
###############################################################################

### 4.1. Admin: Re-Login para Reportes
# @name adminLoginReportes
POST {{baseUrl}}/auth/login/
Content-Type: application/json

{
  "correo": "admin@clinica.com",
  "password": "admin123"
}

###
@adminToken2 = {{adminLoginReportes.response.body.token}}

### 4.2. Admin: Dashboard General
GET {{baseUrl}}/dashboard/
Authorization: Token {{adminToken2}}

### 4.3. Admin: Reporte de Citas
GET {{baseUrl}}/dashboard/citas/?fecha_inicio=2025-11-01&fecha_fin=2025-11-30
Authorization: Token {{adminToken2}}

### 4.4. Admin: Reporte de Ingresos
GET {{baseUrl}}/dashboard/ingresos/?fecha_inicio=2025-11-01&fecha_fin=2025-11-30
Authorization: Token {{adminToken2}}

### 4.5. Admin: Ver AuditorÃ­a (BitÃ¡cora) - Ãšltimos 50 Registros
GET {{baseUrl}}/auditoria/?limit=50
Authorization: Token {{adminToken2}}

### 4.6. Admin: Buscar en AuditorÃ­a por Usuario (Paciente)
GET {{baseUrl}}/auditoria/?usuario={{pacienteCodigo}}
Authorization: Token {{adminToken2}}

### 4.6b. Admin: Ver Resumen de AuditorÃ­a
GET {{baseUrl}}/auditoria/resumen/
Authorization: Token {{adminToken2}}

### 4.6c. Admin: Ver Actividad Reciente (Ãšltimos 20 registros)
GET {{baseUrl}}/auditoria/actividad-reciente/?limit=20
Authorization: Token {{adminToken2}}

### 4.7. Admin: Ver Inventario
GET {{baseUrl}}/inventario/insumos/
Authorization: Token {{adminToken2}}

### 4.8. Admin: Ver Alertas de Inventario
GET {{baseUrl}}/inventario/alertas/?resuelta=false
Authorization: Token {{adminToken2}}

### 4.8b. Admin: Ver Tipos de Pago Disponibles
GET {{baseUrl}}/pagos/tipos-pago/
Authorization: Token {{adminToken2}}

### 4.8c. Admin: Ver Estados de Factura
GET {{baseUrl}}/pagos/estados-factura/
Authorization: Token {{adminToken2}}

### 4.8d. Admin: Listar Todas las Facturas
GET {{baseUrl}}/pagos/facturas/
Authorization: Token {{adminToken2}}

### 4.8e. Admin: Crear Factura para Consulta
# @name crearFactura
POST {{baseUrl}}/pagos/facturas/
Authorization: Token {{adminToken2}}
Content-Type: application/json

{
  "consulta": {{consulta1Id}},
  "paciente": {{paciente1Codigo}},
  "fechaemision": "2025-11-03",
  "montototal": 150.00,
  "idestadofactura": 1,
  "detalles": "Consulta de primera vez y evaluaciÃ³n"
}

###
@facturaId = {{crearFactura.response.body.id}}

### 4.8f. Admin: Ver Detalle de Factura
GET {{baseUrl}}/pagos/facturas/{{facturaId}}/
Authorization: Token {{adminToken2}}

### 4.8g. Admin: Registrar Pago de Tratamiento
# @name registrarPago
POST {{baseUrl}}/tratamientos/pagos/
Authorization: Token {{adminToken2}}
Content-Type: application/json

{
  "plan_tratamiento": {{planId}},
  "presupuesto": {{presupuestoId}},
  "monto": 1000.00,
  "metodo_pago": "tarjeta",
  "estado": "completado",
  "numero_comprobante": "FAC-2025-001",
  "notas": "Pago inicial del tratamiento de endodoncia",
  "registrado_por": "Admin Sistema"
}

###
@pagoId = {{registrarPago.response.body.id}}

### 4.8h. Admin: Procesar Pago en LÃ­nea (SimulaciÃ³n)
# @name pagoOnline
POST {{baseUrl}}/pagos/pagos-online/
Authorization: Token {{adminToken2}}
Content-Type: application/json

{
  "paciente": {{paciente1Codigo}},
  "monto": 500.00,
  "metodo_pago": "tarjeta",
  "descripcion": "Pago parcial de tratamiento",
  "numero_tarjeta_ultimos4": "1234",
  "tipo_tarjeta": "visa"
}

###
@pagoOnlineId = {{pagoOnline.response.body.id}}

### 4.8i. Admin: Verificar Estado de Pago en LÃ­nea
GET {{baseUrl}}/pagos/pagos-online/{{pagoOnlineId}}/estado/
Authorization: Token {{adminToken2}}

### 4.8j. Admin: Ver EstadÃ­sticas Generales del Dashboard
GET {{baseUrl}}/dashboard/estadisticas-generales/
Authorization: Token {{adminToken2}}

### 4.8k. Admin: Ver Pacientes Activos
GET {{baseUrl}}/dashboard/pacientes-activos/
Authorization: Token {{adminToken2}}

### 4.8l. Admin: Ver Tratamientos Activos
GET {{baseUrl}}/dashboard/tratamientos-activos/
Authorization: Token {{adminToken2}}

### 4.8m. Admin: Reporte de Consultas por OdontÃ³logo
GET {{baseUrl}}/reportes/consultas-por-odontologo/?fecha_inicio=2025-11-01&fecha_fin=2025-11-30
Authorization: Token {{adminToken2}}

### 4.8n. Admin: Reporte de Ingresos por Servicio
GET {{baseUrl}}/reportes/ingresos-por-servicio/?fecha_inicio=2025-11-01&fecha_fin=2025-11-30
Authorization: Token {{adminToken2}}

### 4.8o. Admin: Filtrar AuditorÃ­a por AcciÃ³n
GET {{baseUrl}}/auditoria/?accion=create&limit=20
Authorization: Token {{adminToken2}}

### 4.8p. Admin: Filtrar AuditorÃ­a por Rango de Fechas
GET {{baseUrl}}/auditoria/?fecha_inicio=2025-11-03&fecha_fin=2025-11-03&limit=50
Authorization: Token {{adminToken2}}

### 4.8q. Admin: Eliminar Usuario (Desactivar)
# Nota: Comentado por seguridad - descomentar solo si es necesario
# DELETE {{baseUrl}}/usuarios/usuarios/{{paciente3Codigo}}/
# Authorization: Token {{adminToken2}}

### 4.8r. Admin: Eliminar Servicio
# Nota: Comentado por seguridad - descomentar solo si es necesario
# DELETE {{baseUrl}}/administracion/servicios/{{servicioId}}/
# Authorization: Token {{adminToken2}}

### 4.8s. Admin: Eliminar OdontÃ³logo
# Nota: Comentado por seguridad - descomentar solo si es necesario
# DELETE {{baseUrl}}/profesionales/odontologos/{{nuevoUsuarioCodigo}}/
# Authorization: Token {{adminToken2}}

### 4.8t. Admin: Cancelar Consulta
# Nota: Comentado - descomentar si necesitas probar cancelaciÃ³n
# DELETE {{baseUrl}}/citas/consultas/{{consulta2Id}}/
# Authorization: Token {{adminToken2}}

### 4.8u. Admin: Eliminar Insumo de Inventario
# Nota: Comentado por seguridad - descomentar solo si es necesario
# DELETE {{baseUrl}}/inventario/insumos/{{insumoId}}/
# Authorization: Token {{adminToken2}}

### 4.8v. Admin: Eliminar Consentimiento Informado
# Nota: Comentado por seguridad - descomentar solo si es necesario
# DELETE {{baseUrl}}/historial-clinico/consentimientos/{{consentimientoId}}/
# Authorization: Token {{adminToken2}}

### 4.8w. Admin: Actualizar Usuario Existente (Parcial)
PATCH {{baseUrl}}/usuarios/usuarios/{{paciente1Codigo}}/
Authorization: Token {{adminToken2}}
Content-Type: application/json

{
  "telefono": "70000099",
  "recibir_notificaciones": true
}

### 4.9. Admin: LOGOUT FINAL
POST {{baseUrl}}/auth/logout/
Authorization: Token {{adminToken2}}


###############################################################################
# ğŸ¯ RESUMEN DE COBERTURA E2E - FLUJO 100% DIGITAL (COMPLETO)
###############################################################################
#
# âœ… SESIÃ“N 1 - ADMIN: ConfiguraciÃ³n completa del sistema
#    - GestiÃ³n de usuarios, pacientes, odontÃ³logos (CRUD completo + GET detalle)
#    - GestiÃ³n de servicios y combos (CRUD completo)
#    - GestiÃ³n completa de inventario (categorÃ­as, proveedores, insumos, movimientos)
#    - Consultas: crear, actualizar, ver disponibilidad
#    - Horarios: listar, crear nuevos
#    - Especialidades y disponibilidad de odontÃ³logos
#    - ConfiguraciÃ³n del sistema
#
# âœ… SESIÃ“N 2 - ODONTÃ“LOGO: AtenciÃ³n clÃ­nica digital completa
#    - Historial clÃ­nico: crear, actualizar, ver detalle
#    - Odontogramas: crear, actualizar completo y por diente
#    - Planes de tratamiento: crear, actualizar, aprobar, eliminar
#    - Presupuestos: crear, actualizar
#    - Procedimientos: crear, listar
#    - Sesiones de tratamiento: crear, listar
#    - Consentimientos informados
#    - Cambio de estados de consulta (en_consulta, completada)
#
# âœ… SESIÃ“N 3 - PACIENTE: Portal del paciente con aprobaciones en lÃ­nea
#    - Ver perfil y datos personales
#    - Ver consultas, historiales, odontogramas
#    - Ver planes y presupuestos
#    - Aprobar/rechazar presupuestos digitalmente
#    - Firmar consentimientos digitalmente
#    - Ver historial de pagos
#
# âœ… SESIÃ“N 4 - ADMIN: Reportes, pagos y auditorÃ­a completa
#    - Dashboard con estadÃ­sticas generales
#    - Reportes: citas, ingresos, consultas por odontÃ³logo, ingresos por servicio
#    - Pacientes y tratamientos activos
#    - Sistema de pagos completo:
#      * Tipos de pago y estados de factura
#      * Crear facturas
#      * Registrar pagos de tratamientos
#      * Pagos en lÃ­nea y verificaciÃ³n de estado
#    - AuditorÃ­a completa:
#      * Listar con filtros (usuario, acciÃ³n, fecha)
#      * Resumen y actividad reciente
#    - Inventario completo
#    - ActualizaciÃ³n parcial de usuarios (PATCH)
#    - Operaciones de eliminaciÃ³n (comentadas por seguridad)
#
# ğŸ“Š MÃ“DULOS PROBADOS (COBERTURA EXPANDIDA v2.1):
# âœ… AutenticaciÃ³n: Login, logout, tokens (3/5 - sin cambiar/restablecer contraseÃ±a por elecciÃ³n)
# âœ… Usuarios: CRUD completo + GET detalle + actualizaciÃ³n parcial (10/11)
# âœ… Pacientes: CRUD completo (7/8)
# âœ… OdontÃ³logos: CRUD + GET detalle + disponibilidad + especialidades (7/7) â­ 100%
# âœ… Citas: CRUD + estados + disponibilidad + crear horarios (11/12)
# âœ… Servicios: CRUD + combos completo (CRUD completo) (7/7) â­ 100%
# âœ… Historial ClÃ­nico: CRUD + documentos + GET detalle (13/14)
# âœ… Odontogramas: CRUD completo (5/5) â­ 100%
# âœ… Planes de Tratamiento: CRUD completo + aprobar + eliminar (9/9) â­ 100%
# âœ… Presupuestos: CRUD + aprobar/rechazar (9/10)
# âœ… Procedimientos: CRUD completo (3/3) â­ 100%
# âœ… Sesiones de Tratamiento: CRUD completo (3/3) â­ 100%
# âœ… Sistema Pagos: COMPLETO (7/7) â­ 100%
#    - Tipos de pago, estados de factura
#    - Facturas: crear, listar, ver detalle
#    - Pagos de tratamiento: registrar
#    - Pagos en lÃ­nea: procesar, verificar estado
# âœ… Inventario: CRUD completo + GET detalle + movimientos (10/10) â­ 100%
#    - CategorÃ­as: CRUD completo (GET, POST, PUT)
#    - Proveedores: CRUD completo (GET, POST, PUT)
#    - Insumos: CRUD completo + GET detalle
#    - Movimientos de entrada/salida
#    - Alertas
# âœ… Reportes: COMPLETO (8/8) â­ 100%
#    - Dashboard general y estadÃ­sticas
#    - Citas e ingresos
#    - Consultas por odontÃ³logo
#    - Ingresos por servicio
#    - Pacientes y tratamientos activos
# âœ… AuditorÃ­a: Filtrado completo (6/6) â­ 100%
#    - Por usuario, acciÃ³n, fecha
#    - Resumen y actividad reciente
# âœ… ConfiguraciÃ³n: Ver configuraciÃ³n del sistema (1/1) â­ 100%
#
# ğŸ“ˆ COBERTURA TOTAL: ~101 de 103 endpoints (98%) â­
# (Solo excluidos: cambiar/restablecer contraseÃ±a por elecciÃ³n del usuario)
#
# ğŸ‰ MÃ“DULOS AL 100%: 10 de 14 mÃ³dulos
#    1. OdontÃ³logos (7/7)
#    2. Servicios y Combos (7/7)
#    3. Odontogramas (5/5)
#    4. Planes de Tratamiento (9/9)
#    5. Procedimientos (3/3)
#    6. Sesiones de Tratamiento (3/3)
#    7. Sistema de Pagos (7/7)
#    8. Inventario (10/10)
#    9. Reportes y Dashboard (8/8)
#    10. AuditorÃ­a (6/6)
#
# ğŸŒ FILOSOFÃA: 
# - La clÃ­nica fÃ­sica es SOLO para atenciÃ³n mÃ©dica
# - TODO el proceso administrativo es 100% digital
# - Pacientes gestionan todo desde su portal web
# - Sistema de pagos completo integrado
# - AuditorÃ­a exhaustiva de todas las operaciones
# - Inventario con control de stock en tiempo real
#
# ğŸ”’ OPERACIONES DESTRUCTIVAS:
# - DELETE de usuarios, servicios, consultas, planes, etc. estÃ¡n COMENTADAS
# - Descomentar solo cuando sea necesario probarlas
# - Implementan soft-delete (desactivaciÃ³n) en lugar de eliminaciÃ³n fÃ­sica
#
# ğŸ“ NUEVOS ENDPOINTS AGREGADOS (v2.1 - 10 adicionales):
# âœ… GET /usuarios/usuarios/{id}/ - Ver usuario especÃ­fico (1.5b)
# âœ… GET /profesionales/odontologos/{id}/ - Ver odontÃ³logo especÃ­fico (1.7b)
# âœ… GET /administracion/configuracion/ - Ver configuraciÃ³n (1.10b)
# âœ… POST /citas/horarios/ - Crear horario (1.13b)
# âœ… PUT /administracion/combos/{id}/ - Actualizar combo (1.18h2)
# âœ… DELETE /administracion/combos/{id}/ - Eliminar combo (1.18h3 - comentado)
# âœ… PUT /inventario/categorias/{id}/ - Actualizar categorÃ­a (1.18j2)
# âœ… PUT /inventario/proveedores/{id}/ - Actualizar proveedor (1.18l2)
# âœ… GET /inventario/insumos/{id}/ - Ver insumo especÃ­fico (1.18m2)
# âœ… DELETE /tratamientos/planes-tratamiento/{id}/ - Eliminar plan (2.12g2 - comentado)
#
###############################################################################


###############################################################################
###############################################################################
# 
# ğŸ”„ FLUJOS ALTERNATIVOS - PRUEBAS EXHAUSTIVAS DE TODOS LOS ESCENARIOS
#
###############################################################################
###############################################################################


###############################################################################
# ğŸ”´ FLUJO 2: RECHAZO DE PRESUPUESTO
# Escenario: Paciente rechaza presupuesto por precio alto
###############################################################################

### F2.1. ADMIN: Login para preparar caso de rechazo
# @name adminLoginF2
POST {{baseUrl}}/auth/login/
Content-Type: application/json

{
  "correo": "admin@clinica.com",
  "password": "admin123"
}

###
@adminTokenF2 = {{adminLoginF2.response.body.token}}

### F2.2. ADMIN: Listar pacientes existentes del seeder
# @name listarPacientesF2
GET {{baseUrl}}/usuarios/pacientes/
Authorization: Token {{adminTokenF2}}

###
# Usar el segundo paciente disponible (el primero se usa en Flujo 1)
@pacienteF2Codigo = {{listarPacientesF2.response.body.results.[1].codusuario}}
@pacienteF2Email = {{listarPacientesF2.response.body.results.[1].correo}}

### F2.3. ADMIN: Obtener odontÃ³logos existentes
# @name listarOdontologosF2
GET {{baseUrl}}/profesionales/odontologos/
Authorization: Token {{adminTokenF2}}

###
# Usar el segundo odontÃ³logo si hay mÃ¡s de uno
@odontologoF2Codigo = {{listarOdontologosF2.response.body.results.[1].codusuario}}
@odontologoF2Email = {{listarOdontologosF2.response.body.results.[1].email}}

### F2.4a. ADMIN: Obtener horarios disponibles
# @name obtenerHorariosF2
GET {{baseUrl}}/citas/horarios/
Authorization: Token {{adminTokenF2}}

###
@horarioF2Id = {{obtenerHorariosF2.response.body.results.[0].id}}

### F2.4b. ADMIN: Obtener tipos de consulta
# @name obtenerTiposF2
GET {{baseUrl}}/citas/tipos-consulta/
Authorization: Token {{adminTokenF2}}

###
@tipoConsultaF2Id = {{obtenerTiposF2.response.body.results.[0].id}}

### F2.4c. ADMIN: Obtener estados de consulta
# @name obtenerEstadosF2
GET {{baseUrl}}/citas/estados-consulta/
Authorization: Token {{adminTokenF2}}

###
# Usar el segundo estado (Confirmada)
@estadoConfirmadaF2Id = {{obtenerEstadosF2.response.body.results.[1].id}}

### F2.4. ADMIN: Crear consulta para presupuesto costoso
# @name crearConsultaF2
POST {{baseUrl}}/citas/consultas/
Authorization: Token {{adminTokenF2}}
Content-Type: application/json

{
  "codpaciente": "{{pacienteF2Codigo}}",
  "cododontologo": "{{odontologoF2Codigo}}",
  "fecha": "2025-11-05",
  "idhorario": {{horarioF2Id}},
  "idtipoconsulta": {{tipoConsultaF2Id}},
  "idestadoconsulta": {{estadoConfirmadaF2Id}},
  "motivoconsulta": "Ortodoncia completa - caso de presupuesto alto"
}

###
@consultaF2Id = {{crearConsultaF2.response.body.id}}
@consultaF2Numero = {{crearConsultaF2.response.body.numeroconsulta}}

### F2.5. ADMIN: Logout
POST {{baseUrl}}/auth/logout/
Authorization: Token {{adminTokenF2}}

###############################################################################
# ğŸ”„ CAMBIO DE SESIÃ“N: ADMIN â†’ ODONTÃ“LOGO
###############################################################################

### F2.6. ODONTÃ“LOGO: Login con credencial del seeder
# @name odontologoLoginF2
POST {{baseUrl}}/auth/login/
Content-Type: application/json

{
  "correo": "{{odontologoF2Email}}",
  "password": "odontologo123"
}

###
@odontologoTokenF2 = {{odontologoLoginF2.response.body.token}}

### F2.7. ODONTÃ“LOGO: Ver mis consultas programadas (filtrar por nÃºmero de consulta)
GET {{baseUrl}}/citas/consultas/?numeroconsulta={{consultaF2Numero}}
Authorization: Token {{odontologoTokenF2}}

### F2.8. ODONTÃ“LOGO: Crear historial clÃ­nico
# @name historialF2
POST {{baseUrl}}/historial-clinico/
Authorization: Token {{odontologoTokenF2}}
Content-Type: application/json

{
  "pacientecodigo": "{{pacienteF2Codigo}}",
  "motivoconsulta": "Ortodoncia completa",
  "diagnostico": "MaloclusiÃ³n clase II, apiÃ±amiento severo",
  "tratamiento": "EvaluaciÃ³n inicial para ortodoncia",
  "alergias": "Penicilina",
  "enfermedades": "Ninguna",
  "examenbucal": "ApiÃ±amiento dental severo",
  "receta": "No aplica en evaluaciÃ³n inicial"
}

###
@historialF2Id = {{historialF2.response.body.id}}
@historialF2Numero = {{historialF2.response.body.numerohistorial}}

### F2.9. ODONTÃ“LOGO: Crear odontograma
# @name odontogramaF2
POST {{baseUrl}}/historial-clinico/odontogramas/
Authorization: Token {{odontologoTokenF2}}
Content-Type: application/json

{
  "paciente": "{{pacienteF2Codigo}}",
  "odontologo": "{{odontologoF2Codigo}}",
  "observaciones_generales": "EvaluaciÃ³n inicial"
}

### F2.9a. ODONTÃ“LOGO: Obtener servicios disponibles
# @name serviciosF2
GET {{baseUrl}}/administracion/servicios/
Authorization: Token {{odontologoTokenF2}}

###
@servicioF2Id1 = {{serviciosF2.response.body.results.[0].id}}
@servicioF2Id2 = {{serviciosF2.response.body.results.[1].id}}
@servicioF2Id3 = {{serviciosF2.response.body.results.[2].id}}

### F2.10. ODONTÃ“LOGO: Crear plan de tratamiento COSTOSO
# @name planF2
POST {{baseUrl}}/tratamientos/planes-tratamiento/
Authorization: Token {{odontologoTokenF2}}
Content-Type: application/json

{
  "paciente": "{{pacienteF2Codigo}}",
  "odontologo": "{{odontologoF2Codigo}}",
  "descripcion": "Ortodoncia completa con brackets metÃ¡licos",
  "diagnostico": "MaloclusiÃ³n clase II severa",
  "observaciones": "Tratamiento de 24 meses",
  "duracion_estimada_dias": 730
}

###
@planF2Id = {{planF2.response.body.id}}
@planF2Numero = {{planF2.response.body.numeroplan}}

### F2.11. ODONTÃ“LOGO: Crear presupuesto alto
# @name presupuestoF2
POST {{baseUrl}}/tratamientos/presupuestos/
Authorization: Token {{odontologoTokenF2}}
Content-Type: application/json

{
  "plan_tratamiento": {{planF2Id}},
  "items": [
    {
      "servicio": {{servicioF2Id1}},
      "cantidad": 1,
      "precio_unitario": 8000.00,
      "numero_diente": 11
    },
    {
      "servicio": {{servicioF2Id1}},
      "cantidad": 1,
      "precio_unitario": 8000.00,
      "numero_diente": 21
    },
    {
      "servicio": {{servicioF2Id2}},
      "cantidad": 24,
      "precio_unitario": 150.00
    }
  ],
  "descuento": 1000.00,
  "notas": "Ortodoncia completa - 24 meses de tratamiento"
}

###
@presupuestoF2Id = {{presupuestoF2.response.body.id}}

### F2.12. ODONTÃ“LOGO: Logout
POST {{baseUrl}}/auth/logout/
Authorization: Token {{odontologoTokenF2}}

###############################################################################
# ğŸ”„ CAMBIO DE SESIÃ“N: ODONTÃ“LOGO â†’ PACIENTE
###############################################################################

### F2.13. PACIENTE: Login con credencial del seeder
# @name pacienteLoginF2
POST {{baseUrl}}/auth/login/
Content-Type: application/json

{
  "correo": "{{pacienteF2Email}}",
  "password": "paciente123"
}

###
@pacienteTokenF2 = {{pacienteLoginF2.response.body.token}}

### F2.14. PACIENTE: Ver mi perfil
GET {{baseUrl}}/usuarios/pacientes/perfil/
Authorization: Token {{pacienteTokenF2}}

### F2.15. PACIENTE: Ver mis consultas
GET {{baseUrl}}/citas/consultas/mis-consultas/
Authorization: Token {{pacienteTokenF2}}

### F2.16. PACIENTE: Ver presupuesto recibido (filtrar por nÃºmero de plan)
GET {{baseUrl}}/tratamientos/presupuestos/?numeroplan={{planF2Numero}}
Authorization: Token {{pacienteTokenF2}}

### F2.17. PACIENTE: ğŸ”´ RECHAZAR PRESUPUESTO (precio muy alto)
POST {{baseUrl}}/tratamientos/presupuestos/{{presupuestoF2Id}}/rechazar/
Authorization: Token {{pacienteTokenF2}}
Content-Type: application/json

{
  "motivo_rechazo": "El precio es muy elevado para mi presupuesto actual. Necesito explorar otras opciones de pago."
}

### F2.18. PACIENTE: Verificar estado del presupuesto (debe estar rechazado)
GET {{baseUrl}}/tratamientos/presupuestos/{{presupuestoF2Id}}/
Authorization: Token {{pacienteTokenF2}}

### F2.19. PACIENTE: Logout
POST {{baseUrl}}/auth/logout/
Authorization: Token {{pacienteTokenF2}}

###############################################################################
# ğŸ”„ CAMBIO DE SESIÃ“N: PACIENTE â†’ ADMIN
###############################################################################

### F2.20. ADMIN: Re-login para gestionar rechazo
# @name adminLoginF2b
POST {{baseUrl}}/auth/login/
Content-Type: application/json

{
  "correo": "admin@clinica.com",
  "password": "admin123"
}

###
@adminTokenF2b = {{adminLoginF2b.response.body.token}}

### F2.21. ADMIN: Actualizar consulta a cancelada
PUT {{baseUrl}}/citas/consultas/{{consultaF2Id}}/
Authorization: Token {{adminTokenF2b}}
Content-Type: application/json

{
  "idestadoconsulta": 4,
  "observaciones": "Paciente rechazÃ³ presupuesto de ortodoncia - EvaluaciÃ³n inicial. Precio elevado. Pendiente de reagendar con opciones alternativas."
}

### F2.22. ADMIN: Ver auditorÃ­a del rechazo
GET {{baseUrl}}/auditoria/logs/?accion=UPDATE&objeto=Presupuesto
Authorization: Token {{adminTokenF2b}}

### F2.23. ADMIN: Logout
POST {{baseUrl}}/auth/logout/
Authorization: Token {{adminTokenF2b}}


###############################################################################
# ğŸŸ¡ FLUJO 3: MODIFICACIONES DE PLAN DE TRATAMIENTO
# Escenario: Plan inicial se modifica, presupuesto se actualiza
###############################################################################

### F3.1. ADMIN: Login
# @name adminLoginF3
POST {{baseUrl}}/auth/login/
Content-Type: application/json

{
  "correo": "admin@clinica.com",
  "password": "admin123"
}

###
@adminTokenF3 = {{adminLoginF3.response.body.token}}

### F3.2. ADMIN: Listar pacientes existentes del seeder
# @name listarPacientesF3
GET {{baseUrl}}/usuarios/pacientes/
Authorization: Token {{adminTokenF3}}

###
# Usar el tercer paciente disponible (Ã­ndice 2)
@pacienteF3Codigo = {{listarPacientesF3.response.body.results.[2].codusuario}}
@pacienteF3Email = {{listarPacientesF3.response.body.results.[2].correo}}

### F3.3. ADMIN: Obtener odontÃ³logos existentes
# @name listarOdontologosF3
GET {{baseUrl}}/profesionales/odontologos/
Authorization: Token {{adminTokenF3}}

###
# Usar el segundo odontÃ³logo (Ã­ndice 1)
@odontologoF3Codigo = {{listarOdontologosF3.response.body.results.[1].codusuario}}
@odontologoF3Email = {{listarOdontologosF3.response.body.results.[1].email}}

### F3.3a. ADMIN: Obtener horarios disponibles
# @name obtenerHorariosF3
GET {{baseUrl}}/citas/horarios/
Authorization: Token {{adminTokenF3}}

###
@horarioF3Id = {{obtenerHorariosF3.response.body.results.[2].id}}

### F3.3b. ADMIN: Obtener tipos de consulta
# @name obtenerTiposF3
GET {{baseUrl}}/citas/tipos-consulta/
Authorization: Token {{adminTokenF3}}

###
@tipoConsultaF3Id = {{obtenerTiposF3.response.body.results.[0].id}}

### F3.3c. ADMIN: Obtener estados de consulta
# @name obtenerEstadosF3
GET {{baseUrl}}/citas/estados-consulta/
Authorization: Token {{adminTokenF3}}

###
@estadoConfirmadaF3Id = {{obtenerEstadosF3.response.body.results.[1].id}}

### F3.3. ADMIN: Crear consulta para plan modificable
# @name crearConsultaF3
POST {{baseUrl}}/citas/consultas/
Authorization: Token {{adminTokenF3}}
Content-Type: application/json

{
  "codpaciente": "{{pacienteF3Codigo}}",
  "cododontologo": "{{odontologoF3Codigo}}",
  "fecha": "2025-11-05",
  "idhorario": {{horarioF3Id}},
  "idtipoconsulta": {{tipoConsultaF3Id}},
  "idestadoconsulta": {{estadoConfirmadaF3Id}},
  "motivoconsulta": "Endodoncia molar - Dolor intenso"
}

###
@consultaF3Id = {{crearConsultaF3.response.body.id}}
@consultaF3Numero = {{crearConsultaF3.response.body.numeroconsulta}}

### F3.4. ADMIN: Logout
POST {{baseUrl}}/auth/logout/
Authorization: Token {{adminTokenF3}}

###############################################################################
# ğŸ”„ CAMBIO DE SESIÃ“N: ADMIN â†’ ODONTÃ“LOGO
###############################################################################

### F3.5. ODONTÃ“LOGO: Login con credencial del seeder
# @name odontologoLoginF3
POST {{baseUrl}}/auth/login/
Content-Type: application/json

{
  "correo": "{{odontologoF3Email}}",
  "password": "odontologo123"
}

###
@odontologoTokenF3 = {{odontologoLoginF3.response.body.token}}

### F3.6. ODONTÃ“LOGO: Crear historial
# @name historialF3
POST {{baseUrl}}/historial-clinico/
Authorization: Token {{odontologoTokenF3}}
Content-Type: application/json

{
  "pacientecodigo": "{{pacienteF3Codigo}}",
  "motivoconsulta": "Dolor intenso en molar inferior derecho",
  "diagnostico": "Pulpitis irreversible en pieza 46",
  "tratamiento": "EvaluaciÃ³n radiogrÃ¡fica",
  "alergias": "Ninguna",
  "enfermedades": "Ninguna",
  "examenbucal": "Dolor agudo en molar",
  "receta": "Ibuprofeno 400mg cada 8 horas"
}

###
@historialF3Id = {{historialF3.response.body.id}}
@historialF3Numero = {{historialF3.response.body.numerohistorial}}

### F3.6a. ODONTÃ“LOGO: Obtener servicios disponibles
# @name serviciosF3
GET {{baseUrl}}/administracion/servicios/
Authorization: Token {{odontologoTokenF3}}

###
@servicioF3Id1 = {{serviciosF3.response.body.results.[0].id}}
@servicioF3Id2 = {{serviciosF3.response.body.results.[1].id}}
@servicioF3Id3 = {{serviciosF3.response.body.results.[2].id}}

### F3.7. ODONTÃ“LOGO: Crear plan de tratamiento INICIAL
# @name planF3
POST {{baseUrl}}/tratamientos/planes-tratamiento/
Authorization: Token {{odontologoTokenF3}}
Content-Type: application/json

{
  "paciente": "{{pacienteF3Codigo}}",
  "odontologo": "{{odontologoF3Codigo}}",
  "descripcion": "Endodoncia pieza 46",
  "diagnostico": "Pulpitis irreversible",
  "observaciones": "Tratamiento urgente",
  "duracion_estimada_dias": 14
}

###
@planF3Id = {{planF3.response.body.id}}
@planF3Numero = {{planF3.response.body.numeroplan}}

### F3.8. ODONTÃ“LOGO: ğŸŸ¡ MODIFICAR plan - Agregar corona
PUT {{baseUrl}}/tratamientos/planes-tratamiento/{{planF3Id}}/
Authorization: Token {{odontologoTokenF3}}
Content-Type: application/json

{
  "paciente": "{{pacienteF3Codigo}}",
  "odontologo": "{{odontologoF3Codigo}}",
  "descripcion": "Endodoncia pieza 46 + Corona de porcelana",
  "diagnostico": "Pulpitis irreversible - Requiere refuerzo coronario",
  "observaciones": "Plan modificado para incluir corona",
  "duracion_estimada_dias": 28
}

### F3.9. ODONTÃ“LOGO: Crear presupuesto ACTUALIZADO
# @name presupuestoF3
POST {{baseUrl}}/tratamientos/presupuestos/
Authorization: Token {{odontologoTokenF3}}
Content-Type: application/json

{
  "plan_tratamiento": {{planF3Id}},
  "items": [
    {
      "servicio": {{servicioF3Id1}},
      "cantidad": 1,
      "precio_unitario": 800.00,
      "numero_diente": 46
    },
    {
      "servicio": {{servicioF3Id2}},
      "cantidad": 1,
      "precio_unitario": 1200.00,
      "numero_diente": 46
    },
    {
      "servicio": {{servicioF3Id3}},
      "cantidad": 2,
      "precio_unitario": 100.00
    }
  ],
  "descuento": 100.00,
  "notas": "Plan actualizado: incluye corona de porcelana para reforzar diente despuÃ©s de endodoncia. GarantÃ­a de 2 aÃ±os en corona."
}

###
@presupuestoF3Id = {{presupuestoF3.response.body.id}}

### F3.10. ODONTÃ“LOGO: Logout
POST {{baseUrl}}/auth/logout/
Authorization: Token {{odontologoTokenF3}}

###############################################################################
# ğŸ”„ CAMBIO DE SESIÃ“N: ODONTÃ“LOGO â†’ PACIENTE
###############################################################################

### F3.11. PACIENTE: Login con credencial del seeder
# @name pacienteLoginF3
POST {{baseUrl}}/auth/login/
Content-Type: application/json

{
  "correo": "{{pacienteF3Email}}",
  "password": "paciente123"
}

###
@pacienteTokenF3 = {{pacienteLoginF3.response.body.token}}

### F3.12. PACIENTE: Ver plan de tratamiento modificado
GET {{baseUrl}}/tratamientos/planes-tratamiento/{{planF3Id}}/
Authorization: Token {{pacienteTokenF3}}

### F3.13. PACIENTE: Ver presupuesto actualizado
GET {{baseUrl}}/tratamientos/presupuestos/{{presupuestoF3Id}}/
Authorization: Token {{pacienteTokenF3}}

### F3.14. PACIENTE: ğŸŸ¢ APROBAR presupuesto modificado
POST {{baseUrl}}/tratamientos/presupuestos/{{presupuestoF3Id}}/aprobar/
Authorization: Token {{pacienteTokenF3}}

### F3.15. PACIENTE: Logout
POST {{baseUrl}}/auth/logout/
Authorization: Token {{pacienteTokenF3}}


###############################################################################
# ğŸŸ£ FLUJO 4: ELIMINACIONES Y LIMPIEZA DE DATOS
# Escenario: Datos creados por error que deben eliminarse (soft delete)
###############################################################################

### F4.1. ADMIN: Login
# @name adminLoginF4
POST {{baseUrl}}/auth/login/
Content-Type: application/json

{
  "correo": "admin@clinica.com",
  "password": "admin123"
}

###
@adminTokenF4 = {{adminLoginF4.response.body.token}}

### F4.2. ADMIN: Crear servicio ERRÃ“NEO (nombre mal escrito)
# @name servicioErrF4
POST {{baseUrl}}/administracion/servicios/
Authorization: Token {{adminTokenF4}}
Content-Type: application/json

{
  "nombre": "Linpiesa Denta",
  "descripcion": "Servicio creado por error - nombre mal escrito",
  "precio": 150.00,
  "duracion_minutos": 30,
  "categoria": "Preventiva",
  "activo": true
}

###
@servicioErrIdF4 = {{servicioErrF4.response.body.id}}

### F4.3. ADMIN: Crear combo ERRÃ“NEO (precios incorrectos)
# @name comboErrF4
POST {{baseUrl}}/administracion/combos/
Authorization: Token {{adminTokenF4}}
Content-Type: application/json

{
  "nombre": "Combo Error",
  "descripcion": "Combo con precios equivocados",
  "servicios": [1, 2],
  "descuento_porcentaje": 90.00,
  "activo": true
}

###
@comboErrIdF4 = {{comboErrF4.response.body.id}}

### F4.4. ADMIN: Verificar que existen
GET {{baseUrl}}/administracion/servicios/{{servicioErrIdF4}}/
Authorization: Token {{adminTokenF4}}

### F4.5. ADMIN: ğŸŸ£ ELIMINAR servicio errÃ³neo (soft delete)
# DESCOMENTAR PARA PROBAR:
# DELETE {{baseUrl}}/administracion/servicios/{{servicioErrIdF4}}/
# Authorization: Token {{adminTokenF4}}

### F4.6. ADMIN: ğŸŸ£ ELIMINAR combo errÃ³neo (soft delete)
# DESCOMENTAR PARA PROBAR:
# DELETE {{baseUrl}}/administracion/combos/{{comboErrIdF4}}/
# Authorization: Token {{adminTokenF4}}

### F4.7. ADMIN: Verificar auditorÃ­a de eliminaciones
GET {{baseUrl}}/auditoria/logs/?accion=DELETE
Authorization: Token {{adminTokenF4}}

### F4.8. ADMIN: Logout
POST {{baseUrl}}/auth/logout/
Authorization: Token {{adminTokenF4}}


###############################################################################
# ğŸ”µ FLUJO 5: MULTI-PACIENTE - JORNADA LABORAL COMPLETA
# Escenario: Un odontÃ³logo atiende 3 pacientes en el mismo dÃ­a
###############################################################################

### F5.1. ADMIN: Login para preparar jornada
# @name adminLoginF5
POST {{baseUrl}}/auth/login/
Content-Type: application/json

{
  "correo": "admin@clinica.com",
  "password": "admin123"
}

###
@adminTokenF5 = {{adminLoginF5.response.body.token}}

### F5.2. ADMIN: Listar pacientes existentes del seeder
# @name listarPacientesF5
GET {{baseUrl}}/usuarios/pacientes/
Authorization: Token {{adminTokenF5}}

###
# Usar los primeros 3 pacientes del seeder
@paciente1F5Codigo = {{listarPacientesF5.response.body.results.[0].codusuario}}
@paciente2F5Codigo = {{listarPacientesF5.response.body.results.[1].codusuario}}
@paciente3F5Codigo = {{listarPacientesF5.response.body.results.[2].codusuario}}

### F5.3. ADMIN: Obtener odontÃ³logos existentes
# @name listarOdontologosF5
GET {{baseUrl}}/profesionales/odontologos/
Authorization: Token {{adminTokenF5}}

###
# Usar el primer odontÃ³logo
@odontologoF5Codigo = {{listarOdontologosF5.response.body.results.[0].codusuario}}
@odontologoF5Email = {{listarOdontologosF5.response.body.results.[0].email}}

### F5.4a. ADMIN: Obtener horarios disponibles
# @name obtenerHorariosF5
GET {{baseUrl}}/citas/horarios/
Authorization: Token {{adminTokenF5}}

###
@horarioF5Id1 = {{obtenerHorariosF5.response.body.results.[0].id}}
@horarioF5Id2 = {{obtenerHorariosF5.response.body.results.[1].id}}
@horarioF5Id3 = {{obtenerHorariosF5.response.body.results.[2].id}}

### F5.4b. ADMIN: Obtener tipos de consulta
# @name obtenerTiposF5
GET {{baseUrl}}/citas/tipos-consulta/
Authorization: Token {{adminTokenF5}}

###
@tipoConsultaF5Id = {{obtenerTiposF5.response.body.results.[0].id}}

### F5.4c. ADMIN: Obtener estados de consulta
# @name obtenerEstadosF5
GET {{baseUrl}}/citas/estados-consulta/
Authorization: Token {{adminTokenF5}}

###
@estadoConfirmadaF5Id = {{obtenerEstadosF5.response.body.results.[1].id}}

### F5.5. ADMIN: Crear consulta 1 - Paciente 1 (Simple)
# @name consulta1F5
POST {{baseUrl}}/citas/consultas/
Authorization: Token {{adminTokenF5}}
Content-Type: application/json

{
  "codpaciente": "{{paciente1F5Codigo}}",
  "cododontologo": "{{odontologoF5Codigo}}",
  "fecha": "2025-11-06",
  "idhorario": {{horarioF5Id1}},
  "idtipoconsulta": {{tipoConsultaF5Id}},
  "idestadoconsulta": {{estadoConfirmadaF5Id}},
  "motivoconsulta": "Control de rutina"
}

###
@consulta1F5Id = {{consulta1F5.response.body.id}}

### F5.6. ADMIN: Crear consulta 2 - Paciente 2 (Compleja)
# @name consulta2F5
POST {{baseUrl}}/citas/consultas/
Authorization: Token {{adminTokenF5}}
Content-Type: application/json

{
  "codpaciente": "{{paciente2F5Codigo}}",
  "cododontologo": "{{odontologoF5Codigo}}",
  "fecha": "2025-11-06",
  "idhorario": {{horarioF5Id2}},
  "idtipoconsulta": {{tipoConsultaF5Id}},
  "idestadoconsulta": {{estadoConfirmadaF5Id}},
  "motivoconsulta": "Implante dental"
}

###
@consulta2F5Id = {{consulta2F5.response.body.id}}

### F5.7. ADMIN: Crear consulta 3 - Paciente 3 (Urgencia)
# @name consulta3F5
POST {{baseUrl}}/citas/consultas/
Authorization: Token {{adminTokenF5}}
Content-Type: application/json

{
  "codpaciente": "{{paciente3F5Codigo}}",
  "cododontologo": "{{odontologoF5Codigo}}",
  "fecha": "2025-11-06",
  "idhorario": {{horarioF5Id3}},
  "idtipoconsulta": {{tipoConsultaF5Id}},
  "idestadoconsulta": {{estadoConfirmadaF5Id}},
  "motivoconsulta": "Urgencia - Dolor agudo"
}

###
@consulta3F5Id = {{consulta3F5.response.body.id}}

### F5.8. ADMIN: Logout
POST {{baseUrl}}/auth/logout/
Authorization: Token {{adminTokenF5}}

###############################################################################
# ğŸ”„ CAMBIO DE SESIÃ“N: ADMIN â†’ ODONTÃ“LOGO (Inicia jornada)
###############################################################################

### F5.9. ODONTÃ“LOGO: Login con credencial del seeder
# @name odontologoLoginF5
POST {{baseUrl}}/auth/login/
Content-Type: application/json

{
  "correo": "{{odontologoF5Email}}",
  "password": "odontologo123"
}

###
@odontologoTokenF5 = {{odontologoLoginF5.response.body.token}}

### F5.10. ODONTÃ“LOGO: Ver mis consultas del dÃ­a (usando nÃºmero de consulta)
GET {{baseUrl}}/citas/consultas/
Authorization: Token {{odontologoTokenF5}}

###############################################################################
# ğŸ“‹ PACIENTE 1: Control de Rutina
###############################################################################

### F5.11. ODONTÃ“LOGO: Atender paciente 1 - Crear historial
# @name historial1F5
POST {{baseUrl}}/historial/historiales/
Authorization: Token {{odontologoTokenF5}}
Content-Type: application/json

{
  "codpaciente": "{{paciente1F5Codigo}}",
  "cododontologo": "{{odontologoF5Codigo}}",
  "idconsulta": {{consulta1F5Id}},
  "motivoconsulta": "Control de rutina",
  "diagnostico": "Estado dental Ã³ptimo",
  "tratamientorealizado": "Limpieza profesional, aplicaciÃ³n de flÃºor",
  "observaciones": "Mantiene buena higiene oral"
}

###
@historial1F5Id = {{historial1F5.response.body.id}}

### F5.12. ODONTÃ“LOGO: Completar consulta 1 (actualizar estado)
PUT {{baseUrl}}/citas/consultas/{{consulta1F5Id}}/
Authorization: Token {{odontologoTokenF5}}
Content-Type: application/json

{
  "idestadoconsulta": 3,
  "observaciones": "Paciente en excelente estado. PrÃ³ximo control en 6 meses."
}

###############################################################################
# ğŸ“‹ PACIENTE 2: Tratamiento Complejo
###############################################################################

### F5.13. ODONTÃ“LOGO: Atender paciente 2 - Crear historial
# @name historial2F5
POST {{baseUrl}}/historial/historiales/
Authorization: Token {{odontologoTokenF5}}
Content-Type: application/json

{
  "codpaciente": "{{paciente2F5Codigo}}",
  "cododontologo": "{{odontologoF5Codigo}}",
  "idconsulta": {{consulta2F5Id}},
  "motivoconsulta": "ColocaciÃ³n de implante dental",
  "diagnostico": "Ausencia de pieza 36, hueso adecuado para implante",
  "tratamientorealizado": "EvaluaciÃ³n previa, TAC dental, planificaciÃ³n de implante",
  "observaciones": "Paciente con alergia a lÃ¡tex - usar guantes nitrilo"
}

###
@historial2F5Id = {{historial2F5.response.body.id}}

### F5.13a. ODONTÃ“LOGO: Obtener servicios para plan 2
# @name serviciosF5P2
GET {{baseUrl}}/administracion/servicios/
Authorization: Token {{odontologoTokenF5}}

###
@servicioF5P2Id1 = {{serviciosF5P2.response.body.results.[0].id}}
@servicioF5P2Id2 = {{serviciosF5P2.response.body.results.[1].id}}
@servicioF5P2Id3 = {{serviciosF5P2.response.body.results.[2].id}}

### F5.14. ODONTÃ“LOGO: Crear plan de implante
# @name plan2F5
POST {{baseUrl}}/tratamientos/planes-tratamiento/
Authorization: Token {{odontologoTokenF5}}
Content-Type: application/json

{
  "idhistorial": {{historial2F5Id}},
  "descripcion": "Implante dental pieza 36 + Corona",
  "diagnostico": "Ausencia dental - Candidato para implante",
  "objetivos": "Restaurar funciÃ³n masticatoria y recuperar estÃ©tica",
  "tratamientos": [
    {
      "servicio_id": {{servicioF5P2Id1}},
      "descripcion": "Implante dental titanio",
      "preciounitario": 5000.00,
      "cantidad": 1
    },
    {
      "servicio_id": {{servicioF5P2Id2}},
      "descripcion": "Corona sobre implante",
      "preciounitario": 2000.00,
      "cantidad": 1
    },
    {
      "servicio_id": {{servicioF5P2Id3}},
      "descripcion": "Controles post-implante (3 sesiones)",
      "preciounitario": 150.00,
      "cantidad": 3
    }
  ]
}

###
@plan2F5Id = {{plan2F5.response.body.id}}

### F5.15. ODONTÃ“LOGO: Crear presupuesto implante
# @name presupuesto2F5
POST {{baseUrl}}/tratamientos/presupuestos/
Authorization: Token {{odontologoTokenF5}}
Content-Type: application/json

{
  "idplantratamiento": {{plan2F5Id}},
  "montototal": 7450.00,
  "formapago": "Anticipo 50% + saldo en cirugÃ­a",
  "observaciones": "Implante de alta calidad con garantÃ­a de 10 aÃ±os. Incluye todos los controles.",
  "vigenciadias": 20
}

###
@presupuesto2F5Id = {{presupuesto2F5.response.body.id}}

###############################################################################
# ğŸ“‹ PACIENTE 3: Urgencia
###############################################################################

### F5.16. ODONTÃ“LOGO: Atender urgencia - Crear historial
# @name historial3F5
POST {{baseUrl}}/historial/historiales/
Authorization: Token {{odontologoTokenF5}}
Content-Type: application/json

{
  "codpaciente": "{{paciente3F5Codigo}}",
  "cododontologo": "{{odontologoF5Codigo}}",
  "idconsulta": {{consulta3F5Id}},
  "motivoconsulta": "Dolor agudo en molar superior izquierdo",
  "diagnostico": "Absceso periapical pieza 26 - Urgencia",
  "tratamientorealizado": "Drenaje de absceso, prescripciÃ³n de antibiÃ³ticos y analgÃ©sicos",
  "observaciones": "Paciente con dolor intenso nivel 9/10. Se realizÃ³ drenaje de emergencia."
}

###
@historial3F5Id = {{historial3F5.response.body.id}}

### F5.17. ODONTÃ“LOGO: Completar urgencia (actualizar)
PUT {{baseUrl}}/citas/consultas/{{consulta3F5Id}}/
Authorization: Token {{odontologoTokenF5}}
Content-Type: application/json

{
  "idestadoconsulta": 3,
  "observaciones": "Urgencia resuelta. Requiere endodoncia en 48 horas. Paciente medicada y estable."
}

### F5.18. ODONTÃ“LOGO: Ver resumen de mi jornada
GET {{baseUrl}}/citas/consultas/
Authorization: Token {{odontologoTokenF5}}

### F5.19. ODONTÃ“LOGO: Logout (Fin de jornada)
POST {{baseUrl}}/auth/logout/
Authorization: Token {{odontologoTokenF5}}

###############################################################################
# ğŸ”„ CAMBIO DE SESIÃ“N: ODONTÃ“LOGO â†’ ADMIN (RevisiÃ³n de jornada)
###############################################################################

### F5.20. ADMIN: Login para ver reportes
# @name adminLoginF5b
POST {{baseUrl}}/auth/login/
Content-Type: application/json

{
  "correo": "admin@clinica.com",
  "password": "admin123"
}

###
@adminTokenF5b = {{adminLoginF5b.response.body.token}}

### F5.21. ADMIN: Ver reporte de consultas del dÃ­a
GET {{baseUrl}}/reportes/consultas-por-odontologo/?fecha_inicio=2025-11-06&fecha_fin=2025-11-06
Authorization: Token {{adminTokenF5b}}

### F5.22. ADMIN: Ver estadÃ­sticas del dashboard
GET {{baseUrl}}/reportes/dashboard/
Authorization: Token {{adminTokenF5b}}

### F5.23. ADMIN: Ver auditorÃ­a de la jornada
GET {{baseUrl}}/auditoria/logs/?fecha_inicio=2025-11-06&usuario=2
Authorization: Token {{adminTokenF5b}}

### F5.24. ADMIN: Logout
POST {{baseUrl}}/auth/logout/
Authorization: Token {{adminTokenF5b}}


###############################################################################
# ğŸ¯ RESUMEN FLUJOS ALTERNATIVOS
###############################################################################
#
# âœ… FLUJO 2 - RECHAZO: Presupuesto de ortodoncia rechazado por precio alto
#    - Paciente: Ana GarcÃ­a
#    - OdontÃ³logo: Dr. Pedro RamÃ­rez
#    - Resultado: Consulta cancelada, presupuesto rechazado
#    - Intercambios: Admin â†’ OdontÃ³logo â†’ Paciente â†’ Admin (4 cambios)
#
# âœ… FLUJO 3 - MODIFICACIONES: Plan de tratamiento actualizado
#    - Paciente: Carlos Mendoza
#    - OdontÃ³logo: Dra. MarÃ­a LÃ³pez
#    - Cambios: Plan inicial (solo endodoncia) â†’ Plan mejorado (+ corona)
#    - Resultado: Presupuesto modificado aprobado por paciente
#    - Intercambios: Admin â†’ OdontÃ³logo â†’ Paciente (3 cambios)
#
# âœ… FLUJO 4 - ELIMINACIONES: Limpieza de datos errÃ³neos
#    - Operaciones: Soft delete de servicios y combos
#    - VerificaciÃ³n: AuditorÃ­a de eliminaciones
#    - Resultado: Datos desactivados correctamente
#
# âœ… FLUJO 5 - MULTI-PACIENTE: Jornada laboral completa
#    - OdontÃ³logo: Dra. MarÃ­a LÃ³pez
#    - Pacientes atendidos: 3
#      * Laura Ortiz (08:00) - Consulta simple
#      * Roberto Flores (10:00) - Implante dental
#      * Sofia Quispe (14:00) - Urgencia con absceso
#    - Intercambios: Admin â†’ OdontÃ³logo â†’ Admin (3 cambios)
#    - Resultado: 3 historiales, 2 presupuestos, 2 consultas completadas
#
# ğŸ“Š COBERTURA TOTAL DE ESCENARIOS:
# âœ… Aprobaciones de presupuestos (FLUJO 1, 3)
# âœ… Rechazos de presupuestos (FLUJO 2)
# âœ… Modificaciones de planes (FLUJO 3)
# âœ… Eliminaciones soft-delete (FLUJO 4)
# âœ… MÃºltiples pacientes por odontÃ³logo (FLUJO 5)
# âœ… Diferentes tipos de consultas (rutina, compleja, urgencia)
# âœ… Intercambio realista de sesiones (12+ cambios de usuario)
# âœ… AuditorÃ­a completa de todas las operaciones
#
# ğŸ‰ PRUEBAS EXHAUSTIVAS: Todos los caminos felices e infelices cubiertos
#
###############################################################################
